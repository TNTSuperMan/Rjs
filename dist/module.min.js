let e=[],t=[];const s=()=>t[t.length-1];let o=!1;const r=e=>n(e,e),n=(s,r)=>{t.push([]),o=!0,s(),t.length<=1&&(o=!1);const n=t.pop();return n?(e.push(...n.map((e=>[e[0],e[1],r]))),n.map((e=>[e[0],e[1]]))):[]},c=t=>e=e.filter((e=>!t.some((t=>t[0]!=e[0]||2!=t.length||t[1]==e[1])))),h=[],i=t=>{const r=Symbol(),{proxy:n,revoke:i}=Proxy.revocable(t,{get:(e,t,n)=>(o&&!s().some((e=>e[0]==r&&e[1]==t))&&s().push([r,t]),Reflect.get(e,t,n)),set(t,s,o,n){const c=Reflect.set(t,s,o,n);return e.filter((e=>e[0]==r&&e[1]==s)).forEach((e=>e[2]())),c}});return h.push([t,r,()=>{i(),c([[r]])}]),[n,r]};class a{node;#e;#t=[];#s;constructor(e,t=[]){this.node=e,this.#e=t,this.#s=e.remove.bind(e),e.remove=this.destroy}update(){var t;t=this.#e,e.filter((e=>t.some((t=>t[0]==e[0]&&t[1]==e[1])))).forEach((e=>e[2]()))}destroy(){this.#t.forEach((e=>(e=>{const t=h.findIndex((t=>t[1]==e));-1!=t&&(h[t][2](),h.splice(t,1))})(e))),c(this.#e),this.node.childNodes.forEach((e=>e.remove())),this.#s()}fook(e,t){this.#e.push(...n(e,t))}calculate(e){const t=i({value:e()});return this.#t.push(t[1]),this.#e.push(...r((()=>t[0].value=e()))),t[0]}addProxy(e){this.#t.push(e)}}function u(e,t,s={},o=()=>({})){const n=document.createElement(e),c=[];return c.push(...r((()=>{Object.entries(o()).forEach((e=>n.setAttribute(e[0],e[1])))}))),c.push(...r((()=>{n.childNodes.forEach((e=>e.remove())),t().forEach((e=>n.appendChild(e.node)))}))),Object.entries(s).forEach((e=>n.addEventListener(e[0],e[1]))),new a(n,c)}function d(e){const t=new Text;return new a(t,r((()=>t.nodeValue=e())))}export{a as VNode,i as createProxy,u as createVElement,d as createVText};
